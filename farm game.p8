pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	icrops()
	imoney()
	iplr()
	idays()
	itrans()
	state="play"
end


function _update()
	if state=="play" then
		uplr()
		uactions()
		udays()
	elseif state=="dead" then
		if btnp(ðŸ…¾ï¸) then
			run()
		end
	end
end


function _draw()
	cls()
	if state=="play" then
		map()
		dplr()
		dtrans()
		dhud()
	elseif state=="dead" then
		print("battery out, press ðŸ…¾ï¸ to restart",0,50,10)
		print("revenue: $"..revenue,30,70,10)
	end
end
-->8
--player movement--

function iplr()
	plr={
		x=63,
		y=63,
		bat=99
	}
	
	--stick it to whole tiles
	tile={
		x=plr.x/8,
		y=plr.y/8
	}
end


function uplr()
	--â¬…ï¸âž¡ï¸--
	if btn(âž¡ï¸) then
		plr.x+=1
		drain("mv")
	elseif btn(â¬…ï¸) then
		plr.x-=1
		drain("mv")
	end
	
	--â¬†ï¸â¬‡ï¸--
	if btn(â¬†ï¸) then
		plr.y-=1
		drain("mv")
	elseif btn(â¬‡ï¸) then
		plr.y+=1
		drain("mv")
	end
	
		--snap to the tile
	tile={
		x=flr((plr.x+6)/8),
		y=flr((plr.y+8)/8)
	}
end


function dplr()
	spr(4,tile.x*8,tile.y*8) --tile select
	spr(10,plr.x,plr.y)
	
	--debug--
	--print(tile.x)
	--print(tile.y)
end
-->8
--action btn âŽ--

function uactions()
	if btnp(âŽ) then
		local sp=mget(tile.x,tile.y)
		
		if	fget(sp,0) then
			--plant seeds--
			if seeds>0 then
				mset(tile.x,tile.y,33)
				drain("act")
				seeds-=1
				sfx(0)
			else
				sfx(7)
			end
			
		elseif fget(sp,1) then
			--water the tile--
			mset(tile.x,tile.y,sp+16)
			drain("act")
			sfx(1)
			
		elseif	fget(sp,3) then
			--harvest carrot--
			mset(tile.x,tile.y,52)
			harvest()
			drain("act")
			sfx(2)
		 
		elseif fget(sp,4) then
			--dry prog/bat change--
			day+=1
			clock=24
			trans()
			grow()
			plr.bat=99
			sfx(3)
			
		elseif fget(sp,5) then
			--buy seeds--
			if money>0 then
				money-=1
				seeds+=1
				sfx(4)
			end
	
		elseif fget(sp,6) then
			--sell carrot--
			if carrots>0 then
				money+=3
				revenue+=3
				carrots-=1
				sfx(5)
			end
		end
	end
end
-->8
--day cycle--

function idays()
	day=1
	clock=24
end


function udays()
	clock-=.01
	if clock<0 then
		state="dead"
		sfx(6)
	end
end


--transition--
function itrans()
	ttime=128
end

function trans()
	ttime=0
end

function dtrans()
	ttime+=6
	if ttime<128 then
		rectfill(0,0,128,128-ttime,1)
	end
end
-->8
--grow--
function grow()
	for tx=0,15 do	--search for tiles
		for ty=0,15 do
			local sp=mget(tx,ty)
			if fget(sp,2) then
				mset(tx,ty,sp-15)
			end
		end
	end
end
-->8
--money and harvesting--

function icrops()
	carrots=0
	seeds=0
end

function imoney()
	money=12
	revenue=0
end

function harvest()
	carrots+=1
end
-->8
--battery stuff--
function drain(amt)
	if amt=="mv" then
		plr.bat-=.01
	elseif amt=="act" then
		plr.bat-=.1
	end
	
	if plr.bat<0 then
		state="dead"
		sfx(6) 
	end
end
-->8
--hud--
function dhud()
	if clock>5 then
		cclr=10
	else
		cclr=8
	end
	
	if plr.bat>50 then
		bclr=11
		mset(8,15,25)
	elseif plr.bat>20 then
		bclr=10
		mset(8,15,41)
	else
		mset(8,15,57)
		bclr=8
	end
	
	print(flr(clock),88,122,cclr)
	print(day,106,122,10)
	print(carrots,40,122,10)
	print(flr(plr.bat),72,122,bclr)
	print(money,56,122,10)
	print(seeds,24,122,10)
end
__gfx__
00000000bbbbbbbbbbbbbbbbbbbbbbbb0aaaaaa000000000000000000000000000000000000000000006660000000000bb222222222222bbbb222222222222bb
00000000bbbbbbbbbbbbbbbbbbb3bbbba000000a00000000000000000000000000000000000000000066676000000000b299ffffffff992bb299ffffffff992b
00700700bbbbbbbbbbbbbb3bbbb3bbbba000000a00000000000000000000000000000000000000000066666000000000b299ff5555ff992bb299ffffffff992b
00077000bbbbbbbbbbbbb33bbbb3bbbba000000a000000000000000000000000000000000000000000d666d000000000b299f577b75f992bb299ffbff33f992b
00077000bbbbbbbbb3bbb3bbb3bbb3bba000000a000000000000000000000000000000000000000000ddddd000000000b299f5b7975f992bb299ff9bf33f992b
00700700bbbbbbbbb33bb3bbb3bbb3bba000000a00000000000000000000000000000000000000000005550000000000b2fff597775fff2bb2fff9fff33fff2b
00000000bbbbbbbbbb3bbbbbbbbbbbbba000000a00000000000000000000000000000000000000000033733000000000b144f555555f441bb144ffffffff441b
00000000bbbbbbbbbbbbbbbbbbbbbbbb0aaaaaa000000000000000000000000000000000000000000003330000000000b144ffffffff441bb144ffffffff441b
000000000000000000000000000000000000000000000000000000000000000000000000111111110000000011111111b14411111411441bb14411111411441b
000000000000000000000000000000000000000000000000000000000000000000000000111111110000000011111111b144111f4f41441bb144111b4f41441b
000000000000000000000000000000000000000000000000000000000000000000000000666666110000000011111111b1441111ddd1441bb1441111ddd1441b
0000000000000000000000000000000000000000000000000000000000000000000000006bbbb6610000000011111111b14199999999141bb14199999999141b
0000000000000000000000000000000000000000000000000000000000000000000000006bbbb6610000000011111111b14144444444141bb14144444444141b
0000000000000000000000000000000000000000000000000000000000000000000000006bbbb6610000000011111111b12222222222221bb12222222222221b
000000000000000000000000000000000000000000000000000000000000000000000000666666110000000011111111b24242424242424bb24242424242424b
000000000000000000000000000000000000000000000000000000000000000000000000111111110000000011111111b24242424242424bb24242424242424b
00000000b444444bb444444bb444444bb444444b00000000111111111111111111111111111111111111111116111611bbbddddbbbbbbbbb0000000000000000
0000000044444444444444444444444444344b4400000000666661111111b11111111111111111111166661186888681bbd6666dbbbbbbbb0000000000000000
00000000444444444444444444444b444439bb44000000006777b61111119bb1333333316666661116777d6188888881bbd6666ddddbbbbb0000000000000000
000000004444454444444b44444b4b4444a3ba440000000067b79611111999113bbbb3316aa116611677d76167777761bbd7777d666dbbbb0000000000000000
000000004444444444444444444b4444449aa9440000000067977611119991113b33bb316aa116611677d76167777761bb1dddd1666dbbbb0000000000000000
0000000044454444444b4444444b444444999944000000006dddd6111999111133b3bb316aa1166116777d6167777761bb1dadd1777dbbbb0000000000000000
000000004444444444444444444444444459954400000000666666111911111133333331666666111166661166666661bb1ddad1dda1bbbb0000000000000000
00000000b444444bb444444bb444444bb445544b00000000111111111111111111111111111111111111111111111111bb1dddd1dad1bbbb0000000000000000
00000000b444444bb444444bb444444bbbbbbbbb00000000000000000000000000000000111111110000000000000000bb555555555555bb0000000000000000
000000004dddddd44dddddd44dddddd4bb4444bb00000000000000000000000000000000111111110000000000000000b56666666666665b0000000000000000
000000004dddddd44dddddd44ddddbd4b442244b00000000000000000000000000000000666666110000000000000000b56ddd66dddd665b0000000000000000
000000004dddd5d44ddddbd44ddbdbd4b421124b00000000000000000000000000000000681116610000000000000000b56ddd66dddd665b0000000000000000
000000004dddddd44dddddd44ddbddd4b411114b00000000000000000000000000000000681116610000000000000000b56ddd66dddd665b0000000000000000
000000004dd5ddd44ddbddd44ddbddd4b441144b00000000000000000000000000000000681116610000000000000000b56666666666665b0000000000000000
000000004dddddd44dddddd44dddddd4bb4444bb00000000000000000000000000000000666666110000000000000000b57777777777775b0000000000000000
00000000b444444bb444444bb444444bbbbbbbbb00000000000000000000000000000000111111110000000000000000bb555555555555bb0000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00101010101010101010101010101010101010101010101010103010101010101010101010101010101010101010101010101010101010101010101010101010
10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001010100000000000000002020404000000000000000000000000020204040000202020800000000000000101000000004040401000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010c0d0101012c2d0102010e0f010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01011c1d0101013c3d0201011e1f010201010101010201010101020101010101010101010103010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010101030101010103010101010101010101010101010101010101010101010101030101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010301010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010102010101010101020101010301010101010102010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201030101020102030101030103010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101020101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010301010201010101010101010101010101010101010101010301010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010102010101010201020101010101010101010101010101010101010101010201010101030101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010201010101010101010101010101030101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010301010101010101010101020101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010103010101010101010101010101010301010101010301010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010201010102010101010103010101010101010101030101010101010101010103010101020101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1b1b261b271b281b291b2a1b2b1b1b1b1b1b1b1b1b1b1b1b1b01010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010301010101010101010101010102010101010101010101010301010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010201010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010201010101010101010101010101010101010103010101010101010101010103010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020101010102010101010101010103010101010101010101010101010101010101030101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010301010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010101010101010101010102010101030101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010101010201010101010102010101010101010103010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101030101010101010101010101010101010101010101010103010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101020101010101010101010101010102010101030101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010102010101010101010101010101010301010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010101010101010101010301010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010301010101010101010101010101010101010301010101030101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010101010101010101010101010101010101030101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010301010101010101010101030101010103010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010101010101010101010101010101010301010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100001c6501665013650106500d6500b6500865006650076500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300001505000000250302702000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002000000000180501b0502105029050340503905030050230501d05019050150501405000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300001a05021050270502a0502d0402e0402d0302b03027030200301803013040100500f0500f0400e0300f0101001012010150301b0402004000000000000000000000000000000000000000000000000000
0002000000000171501c1502015022150221500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300002905030050320503405034050350503605036050360500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000600002e0502a0502905000000000001a0501a05017050140501305000000000000905007050060500405003050020500205001050010500005000050000000000000000000000000000000000000000000000
000200000000018150000000a15000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
